<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Web Security Attack Surface Map</title>

<style>
.webmap-root{
  color-scheme: dark;

  --bg0: #0a0f1a;
  --bg1: #111827;
  --bg2: #1a2332;
  --panel: rgba(255,255,255,.06);
  --border: rgba(255,255,255,.12);
  --text: #eef2f8;
  --muted: #94a3b8;
  --shadow: 0 25px 50px -12px rgba(0,0,0,.8);
  --radius: 20px;
  --glow: 0 0 15px rgba(106,168,255,.3);

  --blue: #60a5fa;
  --orange: #fb923c;
  --red: #f87171;
  --purple: #c084fc;
  --teal: #2dd4bf;
  --green: #4ade80;
  --yellow: #facc15;

  font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, sans-serif;
  background:
    radial-gradient(1200px 800px at 10% 20%, rgba(96,165,250,.15), transparent 60%),
    radial-gradient(1000px 700px at 90% 70%, rgba(74,222,128,.12), transparent 55%),
    linear-gradient(145deg, var(--bg0), var(--bg1));
  color: var(--text);
  min-height: 100vh;
  margin: 0;
  line-height: 1.5;
}

.webmap-root *{ box-sizing:border-box; }

.webmap-container{
  max-width:1600px;
  margin:0 auto;
  padding:28px;
}

.webmap-header{
  display:flex;
  justify-content:space-between;
  gap:24px;
  margin-bottom:28px;
  flex-wrap:wrap;
}

.webmap-title{
  padding:22px 24px;
  border-radius:var(--radius);
  background:linear-gradient(165deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
  border:1px solid var(--border);
  box-shadow:var(--shadow);
  flex:1;
  backdrop-filter:blur(10px);
  min-width:320px;
}

.webmap-title h1{
  margin:0;
  font-size:32px;
  font-weight:800;
  letter-spacing:-0.5px;
}

.webmap-title .red{
  background: linear-gradient(135deg, var(--red), #ef4444);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.webmap-title .blue{
  background: linear-gradient(135deg, var(--blue), #3b82f6);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.webmap-sub{
  margin-top:12px;
  font-size:14px;
  color:var(--muted);
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.badge{
  background: rgba(96,165,250,.15);
  border: 1px solid rgba(96,165,250,.3);
  padding: 4px 10px;
  border-radius: 40px;
  font-size: 12px;
  font-weight: 600;
}

.webmap-controls{
  width:520px;
  padding:22px;
  border-radius:var(--radius);
  background:linear-gradient(165deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
  border:1px solid var(--border);
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  min-width:320px;
}

.webmap-row{
  display:flex;
  gap:12px;
  margin-bottom:12px;
}

.webmap-input,
.webmap-btn{
  width:100%;
  padding:12px 16px;
  border-radius:14px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.3);
  color:var(--text);
  font-size:14px;
  transition:all .2s ease;
}

.webmap-input::placeholder{
  color: rgba(148,163,184,.85);
}

.webmap-input:focus{
  outline: none;
  border-color: var(--blue);
  box-shadow: var(--glow);
}

.webmap-btn{
  cursor:pointer;
  font-weight:600;
  background:linear-gradient(180deg, rgba(96,165,250,.25), rgba(96,165,250,.1));
  border:1px solid rgba(96,165,250,.3);
  letter-spacing:0.3px;
}

.webmap-btn:hover{
  background:linear-gradient(180deg, rgba(96,165,250,.35), rgba(96,165,250,.15));
  border-color: rgba(96,165,250,.5);
  transform:translateY(-1px);
}

.webmap-btn.secondary{
  background:rgba(255,255,255,.08);
  border-color:var(--border);
}

.webmap-btn.secondary:hover{
  background:rgba(255,255,255,.12);
}

/* Custom dropdowns */
.webmap-dd{
  position:relative;
  width:100%;
}

.webmap-dd-btn{
  width:100%;
  padding:12px 16px;
  border-radius:14px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.3);
  color:var(--text);
  font-size:14px;
  transition:all .2s ease;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.webmap-dd-btn:hover{
  border-color: rgba(255,255,255,.22);
}

.webmap-dd-btn:focus{
  outline:none;
  border-color: var(--blue);
  box-shadow: var(--glow);
}

.webmap-dd-label{
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

.webmap-dd-caret{
  width:10px;
  height:10px;
  border-right:2px solid rgba(238,242,248,.85);
  border-bottom:2px solid rgba(238,242,248,.85);
  transform:rotate(45deg);
  margin-top:-2px;
  flex:0 0 auto;
  opacity:.9;
}

.webmap-dd-panel{
  position:absolute;
  left:0;
  right:0;
  top:calc(100% + 10px);
  background:linear-gradient(165deg, rgba(17,24,39,.98), rgba(26,31,46,.98));
  border:1px solid rgba(255,255,255,.12);
  border-radius:16px;
  box-shadow: 0 25px 60px rgba(0,0,0,.65);
  padding:10px;
  z-index:1200;
  display:none;
  max-height:320px;
  overflow:auto;
  backdrop-filter: blur(10px);
}

.webmap-dd.open .webmap-dd-panel{ display:block; }

.webmap-dd-item{
  width:100%;
  text-align:left;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid transparent;
  background:transparent;
  color:rgba(238,242,248,.92);
  cursor:pointer;
  font-size:14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.webmap-dd-item:hover{
  background:rgba(255,255,255,.06);
  border-color: rgba(255,255,255,.10);
}

.webmap-dd-item[aria-selected="true"]{
  background:rgba(96,165,250,.12);
  border-color: rgba(96,165,250,.25);
}

.webmap-dd-hint{
  font-size:12px;
  color:rgba(148,163,184,.9);
}

.webmap-stats{
  display:flex;
  gap:20px;
  margin-bottom:20px;
  padding:16px 20px;
  background:rgba(255,255,255,.03);
  border-radius:40px;
  border:1px solid var(--border);
  font-size:13px;
  flex-wrap:wrap;
}

.stat-item{
  display:flex;
  align-items:center;
  gap:8px;
}

.stat-dot{
  width:10px;
  height:10px;
  border-radius:50%;
}

.stat-dot.blackbox{ background:var(--blue); }
.stat-dot.greybox{ background:var(--purple); }
.stat-dot.whitebox{ background:var(--green); }

.webmap-disclaimer{
  margin-top:-10px;
  margin-bottom:18px;
  padding:10px 14px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.03);
  color:rgba(148,163,184,.95);
  font-size:12px;
  line-height:1.45;
  max-width:1100px;
}

.webmap-board{
  border-radius:var(--radius);
  border:1px solid var(--border);
  background:rgba(0,0,0,.25);
  box-shadow:var(--shadow);
  padding:24px;
  overflow:auto;                /* important */
  backdrop-filter:blur(4px);
  -webkit-overflow-scrolling: touch;
  scrollbar-gutter: stable both-edges;
}

/* Make the grid a horizontal track that can scroll */
.webmap-columns{
  display:grid;
  grid-auto-flow:column;        /* important */
  grid-auto-columns:minmax(270px, 1fr);
  gap:18px;
  width:max-content;            /* important */
  padding-right:24px;           /* prevents right-edge clipping */
}

/* Optional: slightly smaller cards on narrow screens */
@media (max-width: 900px){
  .webmap-columns{
    grid-auto-columns:minmax(240px, 1fr);
  }
}

.webmap-column{
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:16px;
}

.webmap-col-title{
  font-size:13px;
  font-weight:700;
  letter-spacing:1.5px;
  text-transform:uppercase;
  margin-bottom:16px;
  padding-bottom:8px;
  border-bottom:2px solid currentColor;
}

.webmap-col-title.discovery{color:var(--blue);}
.webmap-col-title.auth{color:var(--orange);}
.webmap-col-title.input{color:var(--purple);}
.webmap-col-title.logic{color:var(--red);}
.webmap-col-title.api{color:var(--teal);}
.webmap-col-title.data{color:var(--green);}
.webmap-col-title.infrastructure{color:var(--yellow);}

.webmap-card{
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
  border:1px solid rgba(255,255,255,.1);
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  cursor:pointer;
  transition:all .2s ease;
  position:relative;
  overflow:hidden;
}

.webmap-card::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:2px;
  background: linear-gradient(90deg, transparent, currentColor, transparent);
  opacity:0;
  transition: opacity .2s ease;
}

.webmap-card:hover::before{ opacity:0.5; }

.webmap-card:hover{
  transform:translateY(-3px);
  border-color:rgba(255,255,255,.3);
  box-shadow:0 10px 20px -10px rgba(0,0,0,.5);
}

.webmap-card.hidden{ display:none; }

.webmap-card-title{
  font-weight:700;
  font-size:15px;
  margin-bottom:4px;
  display:flex;
  align-items:center;
  gap:6px;
}

.severity-indicator{
  display:inline-block;
  width:8px;
  height:8px;
  border-radius:50%;
  margin-right:6px;
}

.severity-critical{ background:var(--red); box-shadow:0 0 10px var(--red); }
.severity-high{ background:var(--orange); box-shadow:0 0 8px var(--orange); }
.severity-medium{ background:var(--yellow); box-shadow:0 0 8px var(--yellow); }
.severity-low{ background:var(--green); box-shadow:0 0 8px var(--green); }

.webmap-card-sub{
  font-size:12px;
  color:var(--muted);
  line-height:1.4;
}

.tech-tag{
  display:inline-block;
  font-size:10px;
  padding:2px 6px;
  border-radius:20px;
  background:rgba(255,255,255,.1);
  margin-top:6px;
  margin-right:4px;
}

.webmap-drawer{
  position:fixed;
  right:0;
  top:0;
  width:500px;
  height:100%;
  background:linear-gradient(165deg, #111827, #1a1f2e);
  border-left:1px solid var(--border);
  box-shadow:-20px 0 50px rgba(0,0,0,.7);
  transform:translateX(100%);
  transition:.35s cubic-bezier(0.4, 0, 0.2, 1);
  padding:28px;
  overflow:auto;
  z-index:1400;
  backdrop-filter:blur(10px);
}

.webmap-drawer.open{ transform:translateX(0); }

.webmap-drawer h2{
  margin-top:0;
  font-size:24px;
  font-weight:700;
  background:linear-gradient(135deg, var(--text), #a5b4fc);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.webmap-drawer h3{
  margin-top:24px;
  margin-bottom:12px;
  font-size:14px;
  letter-spacing:1px;
  text-transform:uppercase;
  color:var(--blue);
  font-weight:600;
}

.webmap-drawer ul{
  padding-left:20px;
  margin:8px 0;
}

.webmap-drawer li{
  margin-bottom:6px;
  color:var(--muted);
}

.evidence-box{
  background:rgba(0,0,0,.3);
  border:1px solid var(--border);
  border-radius:12px;
  padding:12px;
  margin:10px 0;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size:12px;
}

.webmap-close{
  margin-top:30px;
  padding:12px 20px;
  border-radius:14px;
  border:none;
  background:linear-gradient(135deg, var(--red), #b91c1c);
  color:white;
  cursor:pointer;
  font-weight:600;
  width:100%;
  font-size:14px;
  transition:all .2s ease;
}

.webmap-close:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 20px -5px rgba(185,28,28,.5);
}

.webmap-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  opacity:0;
  pointer-events:none;
  transition: opacity .2s ease;
  z-index:1300;
}

.webmap-overlay.open{
  opacity:1;
  pointer-events:auto;
}
</style>
</head>

<body class="webmap-root">
<div class="webmap-container">

  <div class="webmap-header">
    <div class="webmap-title">
      <h1>
        <span> Web</span>
        <span class="red">Security</span>
        <span class="blue">Attack Surface Map</span>
      </h1>
      <div class="webmap-sub">
        <span class="badge" id="webmap-vector-badge">0 Attack Vectors</span>
        <span class="badge" id="webmap-visible-badge">0 Shown</span>
      </div>
    </div>

    <div class="webmap-controls">
      <div class="webmap-row">
        <input id="webmap-search" class="webmap-input" placeholder="Search attacks, techniques, vectors..."/>
      </div>

      <div class="webmap-row">
        <div class="webmap-dd" id="webmap-dd-mode">
          <button id="webmap-mode-btn" class="webmap-dd-btn" type="button" aria-haspopup="listbox" aria-expanded="false">
            <span id="webmap-mode-label" class="webmap-dd-label">All Testing Modes</span>
            <span class="webmap-dd-caret" aria-hidden="true"></span>
          </button>
          <div class="webmap-dd-panel" role="listbox" aria-label="Testing Modes">
            <button class="webmap-dd-item" type="button" role="option" data-value="all" aria-selected="true">
              <span>All Testing Modes</span>
              <span class="webmap-dd-hint">No filter</span>
            </button>
            <button class="webmap-dd-item" type="button" role="option" data-value="blackbox" aria-selected="false">
              <span>Blackbox</span>
              <span class="webmap-dd-hint">No knowledge</span>
            </button>
            <button class="webmap-dd-item" type="button" role="option" data-value="greybox" aria-selected="false">
              <span>Greybox</span>
              <span class="webmap-dd-hint">Partial access</span>
            </button>
            <button class="webmap-dd-item" type="button" role="option" data-value="whitebox" aria-selected="false">
              <span>Whitebox</span>
              <span class="webmap-dd-hint">Full access</span>
            </button>
          </div>
        </div>
      </div>

      <div class="webmap-row">
        <div class="webmap-dd" id="webmap-dd-severity">
          <button id="webmap-severity-btn" class="webmap-dd-btn" type="button" aria-haspopup="listbox" aria-expanded="false">
            <span id="webmap-severity-label" class="webmap-dd-label">All Severities</span>
            <span class="webmap-dd-caret" aria-hidden="true"></span>
          </button>
          <div class="webmap-dd-panel" role="listbox" aria-label="Severities">
            <button class="webmap-dd-item" type="button" role="option" data-value="all" aria-selected="true">
              <span>All Severities</span>
              <span class="webmap-dd-hint">No filter</span>
            </button>
            <button class="webmap-dd-item" type="button" role="option" data-value="critical" aria-selected="false">
              <span>Critical Severity</span>
              <span class="webmap-dd-hint">Typically 9.0 to 10.0</span>
            </button>
            <button class="webmap-dd-item" type="button" role="option" data-value="high" aria-selected="false">
              <span>High Severity</span>
              <span class="webmap-dd-hint">Typically 7.0 to 8.9</span>
            </button>
            <button class="webmap-dd-item" type="button" role="option" data-value="medium" aria-selected="false">
              <span>Medium Severity</span>
              <span class="webmap-dd-hint">Typically 4.0 to 6.9</span>
            </button>
            <button class="webmap-dd-item" type="button" role="option" data-value="low" aria-selected="false">
              <span>Low Severity</span>
              <span class="webmap-dd-hint">Typically 0.1 to 3.9</span>
            </button>
          </div>
        </div>
      </div>

      <div class="webmap-row">
        <button id="webmap-reset" class="webmap-btn secondary" type="button">Reset Filters</button>
      </div>
    </div>
  </div>

  <div class="webmap-stats">
    <div class="stat-item"><span class="stat-dot blackbox"></span> Blackbox: <span id="webmap-stat-blackbox">0</span> vectors</div>
    <div class="stat-item"><span class="stat-dot greybox"></span> Greybox: <span id="webmap-stat-greybox">0</span> vectors</div>
    <div class="stat-item"><span class="stat-dot whitebox"></span> Whitebox: <span id="webmap-stat-whitebox">0</span> vectors</div>
  </div>

  <div class="webmap-disclaimer" id="webmap-disclaimer">
    Mode counts overlap. A single vector can be testable in multiple modes, so totals wonâ€™t sum to the overall vector count.
  </div>

  <div class="webmap-board">
    <div class="webmap-columns" id="webmap-columns"></div>
  </div>
</div>

<div id="webmap-overlay" class="webmap-overlay"></div>

<div id="webmap-drawer" class="webmap-drawer" aria-hidden="true">
  <h2 id="webmap-drawer-title"></h2>
  <div id="webmap-drawer-body"></div>
  <div id="webmap-drawer-tools" class="evidence-box"></div>
  <button class="webmap-close" id="webmap-close-btn" type="button">Close Details</button>
</div>

<script>
const COLUMNS = [
  { key:"discovery", title:"DISCOVERY", cls:"discovery" },
  { key:"auth", title:"AUTHENTICATION", cls:"auth" },
  { key:"injection", title:"INJECTION", cls:"input" },
  { key:"access", title:"ACCESS CONTROL", cls:"logic" },
  { key:"api", title:"API SECURITY", cls:"api" },
  { key:"data", title:"DATA SECURITY", cls:"data" },
  { key:"infra", title:"INFRASTRUCTURE", cls:"infrastructure" }
];

const VECTORS = [
  { id:"recon", col:"discovery", title:"Surface Mapping", sub:"Endpoints, APIs, parameters, technologies", modes:["blackbox","greybox","whitebox"], severity:"medium", tags:["burp","ffuf"] },
  { id:"content-discovery", col:"discovery", title:"Content Discovery", sub:"Hidden pages, legacy routes, staging hints", modes:["blackbox","greybox","whitebox"], severity:"medium", tags:["crawler"] },
  { id:"directory", col:"discovery", title:"Directory Brute Force", sub:"Hidden dirs, backups, admin panels", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["ffuf","dirsearch"] },
  { id:"parameter-mining", col:"discovery", title:"Parameter Mining", sub:"Hidden params, alternate names, pollution risks", modes:["blackbox","greybox"], severity:"medium", tags:["burp"] },
  { id:"tech-fingerprint", col:"discovery", title:"Tech Fingerprinting", sub:"Frameworks, versions, libraries", modes:["blackbox","greybox","whitebox"], severity:"low", tags:["whatweb"] },
  { id:"asset-leaks", col:"discovery", title:"Client Asset Leakage", sub:"Source maps, debug bundles, secrets in JS", modes:["blackbox"], severity:"high", tags:["devtools"] },
  { id:"robots-sitemap", col:"discovery", title:"Robots and Sitemap Review", sub:"Accidental exposure hints and paths", modes:["blackbox"], severity:"low", tags:["review"] },
  { id:"api-discovery", col:"discovery", title:"API Endpoint Discovery", sub:"REST, GraphQL, Swagger, SOAP", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["burp","postman"] },
  { id:"graphql-schema-discovery", col:"discovery", title:"GraphQL Schema Discovery", sub:"Introspection and schema leakage", modes:["blackbox","greybox"], severity:"high", tags:["graphql"] },
  { id:"websocket-discovery", col:"discovery", title:"WebSocket Discovery", sub:"WS endpoints, message types, auth patterns", modes:["blackbox","greybox"], severity:"medium", tags:["burp"] },

  { id:"brute-force", col:"auth", title:"Credential Brute Force", sub:"Rate limits, lockouts, enumeration", modes:["blackbox","greybox"], severity:"high", tags:["burp"] },
  { id:"password-reset", col:"auth", title:"Password Reset Weaknesses", sub:"Token handling, link poisoning, UX flaws", modes:["blackbox","greybox"], severity:"high", tags:["review"] },
  { id:"mfa-bypass", col:"auth", title:"MFA Weaknesses", sub:"Recovery flows, backup codes, step-up gaps", modes:["blackbox","greybox"], severity:"critical", tags:["review"] },
  { id:"session-fixation", col:"auth", title:"Session Fixation", sub:"Rotation failures and adoption", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["burp"] },
  { id:"session-management", col:"auth", title:"Session Management Gaps", sub:"Cookie flags, expiry, logout invalidation", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["devtools"] },
  { id:"jwt-attacks", col:"auth", title:"JWT Security Issues", sub:"Alg allowlist, claim trust, key rotation", modes:["greybox","whitebox"], severity:"critical", tags:["jwt"] },
  { id:"oauth-misconfig", col:"auth", title:"OAuth and OIDC Weaknesses", sub:"Redirect URI, PKCE, state, nonce, leakage", modes:["blackbox","greybox"], severity:"high", tags:["burp"] },
  { id:"sso-misconfig", col:"auth", title:"SSO Integration Weaknesses", sub:"SAML/OIDC config and trust boundaries", modes:["greybox","whitebox"], severity:"high", tags:["review"] },
  { id:"missing-auth", col:"auth", title:"Missing Authentication", sub:"Critical actions reachable unauthenticated", modes:["blackbox","greybox"], severity:"critical", tags:["test"] },
  { id:"auth-bypass", col:"auth", title:"Authentication Bypass", sub:"Logic flaws, alternate flows, headers", modes:["blackbox","greybox"], severity:"critical", tags:["test"] },
  { id:"oauth-mixup", col:"auth", title:"OAuth Mix-Up and Confusion", sub:"Issuer mixups and client confusion", modes:["greybox","whitebox"], severity:"high", tags:["oauth"] },
  { id:"jwt-kid", col:"auth", title:"JWT Key ID Abuse", sub:"kid injection and JWKS trust pitfalls", modes:["greybox","whitebox"], severity:"high", tags:["jwt"] },
  { id:"oauth-redirect-wildcards", col:"auth", title:"Redirect URI Wildcards", sub:"Loose redirect patterns and open redirects", modes:["blackbox","greybox"], severity:"high", tags:["oauth"] },

  { id:"sqli", col:"injection", title:"SQL Injection", sub:"Error, blind, time, second-order", modes:["blackbox","greybox","whitebox"], severity:"critical", tags:["review"] },
  { id:"nosql-injection", col:"injection", title:"NoSQL Injection", sub:"Operator injection and flexible filters", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["review"] },
  { id:"xss", col:"injection", title:"Cross-Site Scripting (XSS)", sub:"Reflected, stored, DOM, CSP review", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["csp"] },
  { id:"dom-xss", col:"injection", title:"DOM-based Vulnerabilities", sub:"Client-side sinks and unsafe DOM APIs", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["devtools"] },
  { id:"ssti", col:"injection", title:"Server-Side Template Injection", sub:"Template context and sandbox escape risks", modes:["greybox","whitebox"], severity:"high", tags:["templating"] },
  { id:"xxe", col:"injection", title:"XXE", sub:"XML entity resolution and external fetch", modes:["blackbox","greybox"], severity:"high", tags:["xml"] },
  { id:"cmd-injection", col:"injection", title:"OS Command Injection", sub:"Unsafe process execution and shell usage", modes:["blackbox","greybox","whitebox"], severity:"critical", tags:["review"] },
  { id:"code-injection", col:"injection", title:"Code Injection", sub:"Eval-like sinks and unsafe interpretation", modes:["greybox","whitebox"], severity:"critical", tags:["review"] },
  { id:"path-traversal", col:"injection", title:"Path Traversal", sub:"Read or write outside intended dirs", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["files"] },
  { id:"file-upload", col:"injection", title:"File Upload Vulnerabilities", sub:"Dangerous types, polyglots, storage abuse", modes:["blackbox","greybox"], severity:"high", tags:["files"] },
  { id:"deserialization", col:"injection", title:"Insecure Deserialization", sub:"Gadget chains and unsafe object graphs", modes:["greybox","whitebox"], severity:"critical", tags:["review"] },
  { id:"prototype-pollution", col:"injection", title:"Prototype Pollution", sub:"Client or server JS object poisoning", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["node"] },
  { id:"hpp", col:"injection", title:"HTTP Parameter Pollution", sub:"Ambiguous parsing and override behavior", modes:["blackbox","greybox"], severity:"medium", tags:["burp"] },
  { id:"crlf", col:"injection", title:"CRLF Injection", sub:"Header splitting and response manipulation", modes:["blackbox","greybox"], severity:"medium", tags:["headers"] },
  { id:"open-redirect", col:"injection", title:"Open Redirect", sub:"Unvalidated redirects and phishing chains", modes:["blackbox","greybox"], severity:"medium", tags:["review"] },
  { id:"request-splitting", col:"injection", title:"HTTP Response Splitting", sub:"Cache and header manipulation via CRLF", modes:["blackbox","greybox"], severity:"medium", tags:["headers"] },
  { id:"json-injection", col:"injection", title:"JSON Injection", sub:"Unsafe serialization and script contexts", modes:["greybox","whitebox"], severity:"medium", tags:["review"] },
  { id:"xpath-injection", col:"injection", title:"XPath Injection", sub:"Unsafe XML query construction", modes:["greybox","whitebox"], severity:"high", tags:["xml"] },
  { id:"ldap-injection", col:"injection", title:"LDAP Injection", sub:"Directory query manipulation", modes:["greybox","whitebox"], severity:"high", tags:["review"] },
  { id:"template-autoescape", col:"injection", title:"Template Auto-Escape Gaps", sub:"Unsafe contexts despite templating", modes:["greybox","whitebox"], severity:"high", tags:["templating"] },

  { id:"idor", col:"access", title:"Insecure Direct Object References", sub:"Object-level authz across CRUD", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["authz"] },
  { id:"missing-authorization", col:"access", title:"Missing Authorization", sub:"Actions without proper permission checks", modes:["blackbox","greybox","whitebox"], severity:"critical", tags:["authz"] },
  { id:"incorrect-authorization", col:"access", title:"Incorrect Authorization", sub:"Policy bypass due to flawed rules", modes:["greybox","whitebox"], severity:"critical", tags:["review"] },
  { id:"priv-esc", col:"access", title:"Privilege Escalation", sub:"Vertical or horizontal escalation", modes:["greybox","whitebox"], severity:"critical", tags:["authz"] },
  { id:"bola", col:"access", title:"BOLA", sub:"Broken object level authorization in APIs", modes:["blackbox","greybox"], severity:"critical", tags:["api"] },
  { id:"bfla", col:"access", title:"BFLA", sub:"Broken function level authorization", modes:["blackbox","greybox"], severity:"high", tags:["api"] },
  { id:"mass-assignment", col:"data", title:"Mass Assignment", sub:"Over-posting and writable field abuse", modes:["greybox","whitebox"], severity:"high", tags:["dto"] },
  { id:"cors-misconfig", col:"access", title:"CORS Misconfiguration", sub:"Origin validation and credentials", modes:["blackbox","greybox"], severity:"medium", tags:["headers"] },
  { id:"csrf", col:"access", title:"CSRF", sub:"Cross-site state changes", modes:["blackbox","greybox"], severity:"medium", tags:["cookies"] },
  { id:"csrf-samesite", col:"access", title:"SameSite Strategy Gaps", sub:"CSRF via lax cookies and subdomains", modes:["blackbox","greybox"], severity:"medium", tags:["cookies"] },
  { id:"clickjacking", col:"access", title:"Clickjacking", sub:"UI redress and framing policy gaps", modes:["blackbox"], severity:"medium", tags:["headers"] },
  { id:"business-logic", col:"access", title:"Business Logic Vulnerabilities", sub:"Abuse flows, price, limits, sequencing", modes:["blackbox","greybox"], severity:"high", tags:["logic"] },
  { id:"race-conditions", col:"access", title:"Race Conditions", sub:"Concurrent requests causing inconsistent state", modes:["blackbox","greybox"], severity:"high", tags:["timing"] },
  { id:"rate-limit", col:"access", title:"Rate Limiting Gaps", sub:"Enumeration and abuse controls", modes:["blackbox","greybox"], severity:"medium", tags:["abuse"] },

  { id:"ssrf", col:"api", title:"SSRF", sub:"URL fetch features and egress controls", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["review"] },
  { id:"ssrf-redirects", col:"api", title:"SSRF via Redirect Chains", sub:"Allowlist bypass and redirect policy gaps", modes:["blackbox","greybox"], severity:"high", tags:["ssrf"] },
  { id:"graphql-attacks", col:"api", title:"GraphQL Weaknesses", sub:"Introspection, cost, resolver authz", modes:["blackbox","greybox"], severity:"high", tags:["graphql"] },
  { id:"graphql-batching", col:"api", title:"GraphQL Batching and Cost Abuse", sub:"DoS via query depth, batching, complexity", modes:["blackbox","greybox"], severity:"medium", tags:["graphql"] },
  { id:"api-authz-consistency", col:"api", title:"API Authz Consistency", sub:"Mismatch between UI and API permissioning", modes:["greybox","whitebox"], severity:"high", tags:["review"] },
  { id:"api-schema-validation", col:"api", title:"Schema Validation Gaps", sub:"Missing type validation and coercion issues", modes:["greybox","whitebox"], severity:"high", tags:["openapi"] },
  { id:"webhook-abuse", col:"api", title:"Webhook Manipulation", sub:"Signature, replay, allowlists", modes:["blackbox","greybox"], severity:"medium", tags:["integrations"] },
  { id:"websockets", col:"api", title:"WebSockets Security", sub:"Auth, message validation, origin, replay", modes:["blackbox","greybox"], severity:"medium", tags:["ws"] },
  { id:"websocket-csrf", col:"api", title:"WebSocket Cross-Site Abuse", sub:"Cross-site initiation and token misuse", modes:["blackbox","greybox"], severity:"medium", tags:["ws"] },
  { id:"api-versioning", col:"api", title:"API Versioning Pitfalls", sub:"Old endpoints with weaker controls", modes:["blackbox","greybox"], severity:"medium", tags:["api"] },
  { id:"http-host-header", col:"api", title:"HTTP Host Header Attacks", sub:"Poisoned links, reset poisoning, routing trust", modes:["blackbox","greybox"], severity:"high", tags:["headers"] },
  { id:"oauth-token-leak", col:"api", title:"Token Leakage", sub:"Referrer, logs, URLs, browser storage", modes:["blackbox","greybox"], severity:"high", tags:["oauth"] },
  { id:"web-llm-attacks", col:"api", title:"Web LLM Attacks", sub:"Prompt injection and data exfil via tools", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["ai"] },

  { id:"data-exposure", col:"data", title:"Sensitive Data Exposure", sub:"PII, tokens, secrets in responses", modes:["blackbox","greybox","whitebox"], severity:"high", tags:["pii"] },
  { id:"excessive-data", col:"data", title:"Excessive Data Exposure", sub:"APIs return more fields than needed", modes:["blackbox","greybox"], severity:"high", tags:["api"] },
  { id:"info-disclosure", col:"data", title:"Information Disclosure", sub:"Errors, debug endpoints, stack traces", modes:["blackbox","greybox"], severity:"medium", tags:["review"] },
  { id:"log-injection", col:"data", title:"Log Injection", sub:"Log forging and parsing safety", modes:["greybox","whitebox"], severity:"medium", tags:["siem"] },
  { id:"crypto-review", col:"data", title:"Crypto Review", sub:"Key handling, algorithms, misuse", modes:["whitebox"], severity:"high", tags:["review"] },
  { id:"insecure-storage", col:"data", title:"Insecure Storage", sub:"Secrets in local storage, cookies, caches", modes:["blackbox","greybox"], severity:"medium", tags:["devtools"] },
  { id:"cache-control", col:"data", title:"Cache Control Failures", sub:"Sensitive responses cached at edge", modes:["blackbox","greybox"], severity:"high", tags:["headers"] },
  { id:"idempotency", col:"data", title:"Idempotency and Replay Issues", sub:"Duplicate processing and replayable actions", modes:["blackbox","greybox"], severity:"medium", tags:["api"] },

  { id:"cache-poisoning", col:"infra", title:"Web Cache Poisoning", sub:"Cache keys, header trust, variants", modes:["blackbox","greybox"], severity:"high", tags:["cdn"] },
  { id:"cache-deception", col:"infra", title:"Web Cache Deception", sub:"Trick cache into storing sensitive content", modes:["blackbox","greybox"], severity:"high", tags:["cdn"] },
  { id:"http-smuggling", col:"infra", title:"HTTP Request Smuggling", sub:"Front end and back end parsing mismatch", modes:["blackbox","greybox"], severity:"high", tags:["http"] },
  { id:"tls-posture", col:"infra", title:"TLS and HSTS Posture", sub:"Downgrade risk and weak configs", modes:["blackbox","greybox"], severity:"medium", tags:["tls"] },
  { id:"dns-attacks", col:"infra", title:"DNS and Rebinding Risks", sub:"Rebinding and trust boundaries", modes:["blackbox"], severity:"medium", tags:["dns"] },
  { id:"subdomain-takeover", col:"infra", title:"Subdomain Takeover", sub:"Dangling DNS and cloud resources", modes:["blackbox","greybox"], severity:"high", tags:["dns"] },
  { id:"security-headers", col:"infra", title:"Security Headers", sub:"CSP, HSTS, XFO, CORP, COOP, COEP", modes:["blackbox","greybox"], severity:"medium", tags:["headers"] },
  { id:"reverse-proxy", col:"infra", title:"Reverse Proxy Misconfig", sub:"Bypass routes, auth offload gaps", modes:["greybox","whitebox"], severity:"high", tags:["nginx"] },
  { id:"container-hardening", col:"infra", title:"Container Hardening Gaps", sub:"Root, caps, mounts, runtime policy", modes:["whitebox"], severity:"critical", tags:["k8s"] },
  { id:"cloud-metadata", col:"infra", title:"Cloud Metadata Exposure", sub:"Instance credentials and boundary failures", modes:["greybox","whitebox"], severity:"critical", tags:["cloud"] }
];

const state = {
  q: "",
  mode: "all",
  severity: "all"
};

function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function normalizeText(s){ return (s || "").toLowerCase(); }

function severityToCvss(sev){
  const s = (sev || "medium").toLowerCase();
  if (s === "critical") return "9.0-10.0 (typical range)";
  if (s === "high") return "7.0-8.9 (typical range)";
  if (s === "medium") return "4.0-6.9 (typical range)";
  return "0.1-3.9 (typical range)";
}

function severityColor(sev){
  const s = (sev || "medium").toLowerCase();
  if (s === "critical") return "var(--red)";
  if (s === "high") return "var(--orange)";
  if (s === "medium") return "var(--yellow)";
  return "var(--green)";
}

function openDrawer(title, bodyHtml, sev){
  document.getElementById("webmap-drawer-title").innerText = title;

  const color = severityColor(sev);
  const cvss = severityToCvss(sev);

  document.getElementById("webmap-drawer-body").innerHTML = bodyHtml;
  document.getElementById("webmap-drawer-tools").innerHTML = `
    <strong>Severity:</strong>
    <span style="color:${color}; font-weight:800;">${escapeHtml((sev || "medium").toUpperCase())}</span><br>
    <strong>CVSS v3.1:</strong> ${escapeHtml(cvss)}<br>
    <strong>Note:</strong> Keep testing authorized and within scope. Focus on evidence, detection, and remediation.
  `;

  document.getElementById("webmap-overlay").classList.add("open");
  document.getElementById("webmap-drawer").classList.add("open");
  document.getElementById("webmap-drawer").setAttribute("aria-hidden", "false");
}

function webmapClose(){
  document.getElementById("webmap-drawer").classList.remove("open");
  document.getElementById("webmap-overlay").classList.remove("open");
  document.getElementById("webmap-drawer").setAttribute("aria-hidden", "true");
}

function closeAllDropdowns(){
  document.querySelectorAll(".webmap-dd.open").forEach(dd => {
    dd.classList.remove("open");
    const btn = dd.querySelector(".webmap-dd-btn");
    if (btn) btn.setAttribute("aria-expanded", "false");
  });
}

function setSelected(dd, value){
  dd.querySelectorAll(".webmap-dd-item").forEach(it => {
    it.setAttribute("aria-selected", String(it.dataset.value === value));
  });
}

function initDropdown(ddId, labelId, onPick){
  const dd = document.getElementById(ddId);
  const btn = dd.querySelector(".webmap-dd-btn");
  const label = document.getElementById(labelId);

  btn.addEventListener("click", (e) => {
    e.stopPropagation();
    const isOpen = dd.classList.contains("open");
    closeAllDropdowns();
    if (!isOpen){
      dd.classList.add("open");
      btn.setAttribute("aria-expanded", "true");
    }
  });

  dd.querySelectorAll(".webmap-dd-item").forEach(it => {
    it.addEventListener("click", (e) => {
      e.preventDefault();
      const value = it.dataset.value;
      const leftText = it.querySelector("span") ? it.querySelector("span").innerText.trim() : value;
      label.textContent = leftText;
      setSelected(dd, value);
      closeAllDropdowns();
      onPick(value);
    });
  });
}

function updateStats(){
  const all = VECTORS.length;
  const modeCounts = { blackbox:0, greybox:0, whitebox:0 };

  VECTORS.forEach(v => {
    const modes = v.modes || [];
    if (modes.includes("blackbox")) modeCounts.blackbox++;
    if (modes.includes("greybox")) modeCounts.greybox++;
    if (modes.includes("whitebox")) modeCounts.whitebox++;
  });

  const badge = document.getElementById("webmap-vector-badge");
  if (badge) badge.textContent = `${all} Attack Vectors`;

  const elB = document.getElementById("webmap-stat-blackbox");
  const elG = document.getElementById("webmap-stat-greybox");
  const elW = document.getElementById("webmap-stat-whitebox");
  if (elB) elB.textContent = String(modeCounts.blackbox);
  if (elG) elG.textContent = String(modeCounts.greybox);
  if (elW) elW.textContent = String(modeCounts.whitebox);
}

function updateVisibleBadge(){
  const cards = [...document.querySelectorAll(".webmap-card")];
  const shown = cards.filter(c => !c.classList.contains("hidden")).length;
  const el = document.getElementById("webmap-visible-badge");
  if (el) el.textContent = `${shown} Shown`;
}

function applyFilters(){
  const q = normalizeText(state.q);
  const mode = state.mode;
  const severity = state.severity;

  const cards = [...document.querySelectorAll(".webmap-card")];
  cards.forEach(c => {
    const textOk = !q || normalizeText(c.innerText).includes(q);
    const modeOk = mode === "all" || (c.dataset.modes || "").split(",").map(x => x.trim()).includes(mode);
    const sev = (c.dataset.severity || "all").toLowerCase();
    const severityOk = severity === "all" || sev === severity;
    c.classList.toggle("hidden", !(textOk && modeOk && severityOk));
  });

  updateVisibleBadge();
}

function render(){
  updateStats();

  const columnsEl = document.getElementById("webmap-columns");
  columnsEl.innerHTML = "";

  const byCol = {};
  COLUMNS.forEach(c => byCol[c.key] = []);
  VECTORS.forEach(v => {
    if (!byCol[v.col]) byCol[v.col] = [];
    byCol[v.col].push(v);
  });

  COLUMNS.forEach(c => {
    const col = document.createElement("div");
    col.className = "webmap-column";
    col.innerHTML = `<div class="webmap-col-title ${c.cls}">${escapeHtml(c.title)}</div>`;

    const items = byCol[c.key] || [];
    items.forEach(v => {
      const card = document.createElement("div");
      card.className = "webmap-card";
      card.dataset.id = v.id;
      card.dataset.modes = (v.modes || []).join(",");
      card.dataset.severity = v.severity || "medium";

      const sevCls =
        v.severity === "critical" ? "severity-critical" :
        v.severity === "high" ? "severity-high" :
        v.severity === "medium" ? "severity-medium" :
        "severity-low";

      const tags = (v.tags || []).map(t => `<span class="tech-tag">${escapeHtml(t)}</span>`).join("");

      card.innerHTML = `
        <div class="webmap-card-title">
          <span class="severity-indicator ${sevCls}"></span>
          ${escapeHtml(v.title)}
        </div>
        <div class="webmap-card-sub">${escapeHtml(v.sub || "")}</div>
        ${tags}
      `;

      card.addEventListener("click", () => {
        const body = `
          <p><strong>${escapeHtml(v.title)}</strong></p>
          <p>${escapeHtml(v.sub || "")}</p>
          <h3>Testing methodology</h3>
          <ul>
            <li>Identify relevant endpoints and preconditions</li>
            <li>Compare behavior across roles and tenants</li>
            <li>Check for consistent validation and safe error handling</li>
            <li>Capture clear, minimal proof and impact</li>
          </ul>
          <h3>Remediation</h3>
          <p>Validate inputs, enforce authorization server-side, harden configs, and add monitoring.</p>
        `;
        openDrawer(v.title, body, v.severity);
        location.hash = `#${encodeURIComponent(v.id)}`;
      });

      col.appendChild(card);
    });

    columnsEl.appendChild(col);
  });

  applyFilters();
}

document.addEventListener("click", () => closeAllDropdowns());
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape"){
    closeAllDropdowns();
    webmapClose();
  }
});

document.getElementById("webmap-search").addEventListener("input", (e) => {
  state.q = e.target.value || "";
  applyFilters();
});

document.getElementById("webmap-reset").addEventListener("click", () => {
  document.getElementById("webmap-search").value = "";
  state.q = "";
  state.mode = "all";
  state.severity = "all";

  document.getElementById("webmap-mode-label").textContent = "All Testing Modes";
  document.getElementById("webmap-severity-label").textContent = "All Severities";

  setSelected(document.getElementById("webmap-dd-mode"), "all");
  setSelected(document.getElementById("webmap-dd-severity"), "all");

  applyFilters();
});

document.getElementById("webmap-overlay").addEventListener("click", () => webmapClose());
document.getElementById("webmap-close-btn").addEventListener("click", () => webmapClose());

document.addEventListener("DOMContentLoaded", () => {
  initDropdown("webmap-dd-mode", "webmap-mode-label", (val) => {
    state.mode = val;
    applyFilters();
  });

  initDropdown("webmap-dd-severity", "webmap-severity-label", (val) => {
    state.severity = val;
    applyFilters();
  });

  render();

  const hash = decodeURIComponent((location.hash || "").replace("#", "")).trim();
  if (hash){
    const target = [...document.querySelectorAll(".webmap-card")].find(c => c.dataset.id === hash);
    if (target){
      target.scrollIntoView({ behavior: "smooth", block: "center", inline: "center" });
      target.click();
    }
  }
});
</script>
</body>
</html>
